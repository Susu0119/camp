<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.m4gi.mapper.admin.AdminReservationMapper">

    <resultMap id="ReservationListMap" type="com.m4gi.dto.admin.AdminReservationListDTO">
        <result property="reservationId" column="reservation_id" />
        <result property="userNickname" column="user_nickname" />
        <result property="campgroundName" column="campground_name" />
        <result property="checkinDate" column="checkin_date" />
        <result property="checkoutDate" column="checkout_date" />
        <result property="reservationStatus" column="reservation_status" />
        <result property="paymentStatus" column="payment_status" />
    </resultMap>

    <select id="findAllReservations" resultMap="ReservationListMap">
        SELECT
        r.reservation_id,
        u.nickname AS user_nickname,
        c.name AS campground_name,
        r.checkin_date,
        r.checkout_date,
        r.reservation_status,
        r.payment_status
        FROM reservations r
        JOIN users u ON r.provider_code = u.provider_code AND r.provider_user_id = u.provider_user_id
        JOIN campgrounds c ON r.campground_id = c.campground_id
    </select>

    <select id="findReservationById" parameterType="String"
            resultType="com.m4gi.dto.admin.AdminReservationDetailDTO">
        SELECT
        r.reservation_id,
        u.nickname AS user_nickname,
        c.name AS campground_name,
        r.site_id,
        r.reservation_date,
        r.checkin_date,
        r.checkout_date,
        r.reservation_status,
        r.payment_status,

        IFNULL(r.cancel_reason, '-') AS cancel_reason,
        IFNULL(r.refund_status, '없음') AS refund_status,

        r.requested_at,
        r.refunded_at
        FROM reservations r
        JOIN users u ON r.provider_code = u.provider_code AND r.provider_user_id = u.provider_user_id
        JOIN campgrounds c ON r.campground_id = c.campground_id
        WHERE r.reservation_id = #{reservationId}
    </select>

</mapper>
